<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cafe Admin - Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">Cafe Admin</a>
        <div class="d-flex gap-2">
            <a class="btn btn-outline-light btn-sm" th:href="@{/admin/products}">Products</a>
            <a class="btn btn-outline-light btn-sm" th:href="@{/admin/users}">Users</a>
            <a class="btn btn-outline-light btn-sm" th:href="@{/admin/tables}">Tables</a>
            <a class="btn btn-outline-light btn-sm" th:href="@{/admin/settings}">Settings</a>
            <a class="btn btn-outline-light btn-sm" th:href="@{/pos}">POS</a>
            <form th:action="@{/logout}" method="post">
                <button class="btn btn-danger btn-sm" type="submit">Logout</button>
            </form>
        </div>
    </div>
</nav>

<main class="container py-4">
    <h2 class="mb-4">Dashboard Overview</h2>
    <div class="row g-3">
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <p class="text-muted mb-1">Revenue Today</p>
                    <h3 class="fw-bold" th:text="${#numbers.formatDecimal(stats.revenueToday(),1,2)}">$0.00</h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <p class="text-muted mb-1">Orders Today</p>
                    <h3 class="fw-bold" th:text="${stats.ordersToday()}">0</h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <p class="text-muted mb-1">Top Selling Item</p>
                    <h3 class="fw-bold" th:text="${stats.topSellingItem()}">N/A</h3>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4 g-3">
        <div class="col-lg-8">
            <div class="card shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">Revenue</h5>
                        <div class="btn-group btn-group-sm" role="group">
                            <button class="btn btn-outline-primary active" data-range="today">Today</button>
                            <button class="btn btn-outline-primary" data-range="week">Week</button>
                            <button class="btn btn-outline-primary" data-range="month">Month</button>
                        </div>
                    </div>
                    <canvas id="revenueChart" height="120"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card shadow-sm h-100">
                <div class="card-body">
                    <h5>Product Mix</h5>
                    <canvas id="mixChart" height="220"></canvas>
                </div>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
    const rangeButtons = document.querySelectorAll('[data-range]');
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    const mixCtx = document.getElementById('mixChart').getContext('2d');
    let revenueChart = new Chart(revenueCtx, {type: 'bar', data: {labels: [], datasets: [{label: 'Revenue', data: []}]}});
    let mixChart = new Chart(mixCtx, {type: 'pie', data: {labels: [], datasets: [{data: []}]}});

    async function loadRevenue(range = 'today') {
        const response = await fetch(`/api/admin/dashboard/revenue?range=${range}`);
        const data = await response.json();
        revenueChart.data.labels = data.map(point => point.label);
        revenueChart.data.datasets[0].data = data.map(point => point.value);
        revenueChart.update();
    }

    async function loadMix() {
        const res = await fetch('/api/admin/dashboard/product-mix');
        const data = await res.json();
        mixChart.data.labels = data.map(point => point.label);
        mixChart.data.datasets[0].data = data.map(point => point.value);
        mixChart.update();
    }

    rangeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            rangeButtons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            loadRevenue(btn.dataset.range);
        });
    });

    loadRevenue();
    loadMix();
</script>
</body>
</html>

